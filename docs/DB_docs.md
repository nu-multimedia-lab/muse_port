# 🎨 データベース設計書

## 🧱 使用技術スタック（AWS無料枠対象）

- **DynamoDB**（NoSQL DB）: 作品・タグインデックス管理
- **S3**: 画像・動画などのメディアファイル保存
- **Lambda**: バックエンドAPI
- **API Gateway**: HTTPエンドポイント

---

## 📦 テーブル設計

### 🗂️ Table: `works`

| 属性名        | 型           | 説明                                      |
|---------------|--------------|-------------------------------------------|
| `id`          | string       | 作品ID（UUID）※PK                        |
| `user_id`     | string       | 投稿者ユーザーID                          |
| `title`       | string       | タイトル                                  |
| `content`     | string       | 本文（テキスト or Markdown）              |
| `tags`        | list[string] | タグのリスト（["music", "3D"]など）       |
| `media_urls`  | list[string] | S3に保存した画像/動画のURL                |
| `created_at`  | string       | ISO8601形式（例: `"2025-04-16T10:00:00"`）|
| `updated_at`  | string       | 同上                                      |

> **備考**：タグによる絞り込みには別テーブル `tag_index` を使用

---

### 🏷️ Table: `tag_index`

タグで記事を検索するためのインデックステーブル。

| 属性名       | 型     | 説明                            |
|--------------|--------|---------------------------------|
| `tag`        | string | タグ名（※PK）                  |
| `work_id` | string | 該当記事ID（※ソートキー）         |
| `created_at` | string | 作品作成日時（並び替えに使用）  |

> **Query例**：`tag = "music"` でクエリすると `"music"` タグのすべての記事IDを取得できる。

---

## 🔁 処理フロー概要

### ✅ 記事の新規投稿

1. `works` テーブルに新しい記事を保存
2. 記事のタグごとに `tag_index` にレコードを追加

### ✏️ 記事の編集（タグ変更含む）

- 既存の `tag_index` エントリを削除し、新しいタグで再登録

### 🗑️ 記事の削除

1. `works` テーブルから対象記事を削除
2. 関連する `tag_index` のエントリも削除

---

## 🗃️ S3構成

- バケット名例: `museport-media-bucket`
- ディレクトリ構成: `/{work_id}/image1.png`, `/{work_id}/video.mp4` など
- アップロード時に `work_id` をキーとして使用し、整理

> URLは `media_urls` に保存する

---

## 💸 AWS 無料枠における使用目安

| サービス   | 無料枠                         | 見込み消費              |
|------------|--------------------------------|-------------------------|
| DynamoDB   | 25GB / 25RCU / 25WCU           | ✅ 十分に収まる         |
| S3         | 5GB / 2,000 PUT / 20,000 GET   | ✅ 数百作品レベルで余裕 |
| Lambda     | 100万リクエスト / 月           | ✅ 問題なし             |
| API Gateway| 100万呼び出し / 月             | ✅ 問題なし             |

---

## 📌 補足メモ

- `tags` を直接 `works` に持たせることで、記事ごとのタグ表示が簡単に
- タグでの検索を成立させるため、**`tag_index`の管理が重要**
- `created_at` は並び替え目的でインデックスにも含めると便利

---

## 🧪 今後の拡張例（アイデア）

- `likes` 数のカウント → 新しい属性で追加
- コメント機能 → `comments` テーブルを分離
- タグランキング → `tag_index` を元に集計Lambdaで処理

